<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>旅遊新聞輪播</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }

    #home_newsSection {
      display: flex;
      flex-direction: column;
    }

    /* 輪播容器 */
    .carousel-container {
      /* border: 2px solid rgb(87, 8, 185); */
      height: 65vh;
      position: relative;
      max-width: 50vw;
      margin: 20px auto;
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* 輪播列表容器 */
    .carousel-inner {
      display: flex;
      transition: transform 0.5s ease-in-out;
      /* 加入過渡效果 */
    }

    /* 單個輪播項目 */
    .carousel-slide {
      min-width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .carousel-slide img {
      width: 100%;
      height: 55vh;
      object-fit: contain;
      border-radius: 10px;
    }

    /* 新聞標題放在圖片下方 */
    .carousel-slide h2 {
      /* border: 2px solid rgb(127, 215, 11); */
      display: flex;
      align-items: center;
      justify-content: center;
      height: 1vh;
      padding: 10px;
      /* border-radius: 5px; */
      max-width: 100%;
      font-size: 18px;
      /* text-align: center; */
      margin-top: 10px;
    }

    .carousel-slide h2 a {
      color: black;
      text-decoration: none;
    }

    .carousel-slide h2 a:hover {
      text-decoration: underline;
    }

    /* 調整按鈕與圓點的位置 */
    .carousel-dots-container {
      /* border: 2px solid red; */
      display: flex;
      /* border-bottom: 10vh; */
      justify-content: center;
      align-items: center;
      position: relative;
      bottom: 7vh;
      left: 43vw;
      width: 13%;
      margin-top: 6px;
    }

    /* 輪播控制按鈕 */
    .prev,
    .next {
      cursor: pointer;
      width: 25px;
      height: 25px;
      color: white;
      font-weight: bold;
      font-size: 18px;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
    }

    .prev:hover,
    .next:hover {
      background-color: rgba(0, 0, 0, 0.8);
    }

    /* 圓點指示器 */
    .carousel-dots {
      display: flex;
      justify-content: center;
      flex-grow: 1;
    }

    .carousel-dots span {
      cursor: pointer;
      height: 15px;
      width: 15px;
      margin: 0 5px;
      background-color: #bbb;
      border-radius: 50%;
      display: inline-block;
      transition: background-color 0.3s ease;
    }

    .carousel-dots span.active {
      background-color: #717171;
    }
  </style>
</head>

<body>
  <section id="home_newsSection">
    <div class="carousel-container">
      <div class="carousel-inner" id="carousel-inner">
        <!-- 輪播內容會動態插入 -->
      </div>
    </div>

    <!-- 圓點指示器 -->
    <div class="carousel-dots-container">
      <a class="prev" onclick="changeSlide(-1)">&#10094;</a>
      <div class="carousel-dots" id="carousel-dots"></div>
      <a class="next" onclick="changeSlide(1)">&#10095;</a>
    </div>
  </section>

  <script>
    let slideIndex = 0;
    let totalSlides;
    const apiKey = 'ff4b3af578664a56b7c10de98a705f8b';  // 替換為你的 NewsAPI 金鑰
    const query = '飛機 AND 旅行';  // 你想搜索的新聞主題
    const apiUrl = `https://newsapi.org/v2/everything?q=${query}&apiKey=${apiKey}&language=zh`;
    const carouselInner = document.getElementById('carousel-inner');
    const carouselDots = document.getElementById('carousel-dots');
    let slides;

    // 使用 fetch 獲取新聞資料
    function homeNews() {
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          carouselInner.innerHTML = '';  // 清空之前的輪播內容
          carouselDots.innerHTML = ''; // 清空圓點

          let validArticles = 0;  // 計算有效的新聞數量

          // 迭代每篇新聞資料，最多抓取10則新聞
          data.articles.some((article) => {
            if (!article.urlToImage || !article.title || article.urlToImage.includes("yahoo_default_logo")) {
              return false;
            }

            validArticles++;  // 每當有有效新聞就計數

            const slideElement = document.createElement('div');
            slideElement.classList.add('carousel-slide');
            slideElement.innerHTML = `
              <img src="${article.urlToImage}" alt="新聞圖像">
              <h2><a href="${article.url}" target="_blank">${article.title}</a></h2>
            `;
            carouselInner.appendChild(slideElement);

            return validArticles === 6;
          });

          slides = document.getElementsByClassName('carousel-slide');
          totalSlides = slides.length;

          // 生成對應幻燈片的圓點
          for (let i = 0; i < totalSlides; i++) {
            const dot = document.createElement('span');
            dot.setAttribute('onclick', `goToSlide(${i})`);
            if (i === 0) {
              dot.classList.add('active');  // 第一個圓點活動狀態
            }
            carouselDots.appendChild(dot);
          }

          if (validArticles > 0) {
            startCarousel();  // 啟動輪播
          }
        })
        .catch(error => {
          console.error('無法取得新聞資料:', error);
        });
    }

    homeNews();

    // 啟動輪播的函數，只會執行一次
    function startCarousel() {
      setInterval(() => changeSlide(1), 10000);  // 每 5 秒切換一次
    }

    // 切換輪播圖片的函數
    function changeSlide(n) {
      slideIndex += n;
      if (slideIndex >= totalSlides) {
        slideIndex = 0;
      }
      if (slideIndex < 0) {
        slideIndex = totalSlides - 1;
      }
      updateCarousel();
    }

    // 跳轉到指定幻燈片
    function goToSlide(index) {
      slideIndex = index;
      updateCarousel();
    }

    // 更新輪播
    function updateCarousel() {
      const offset = -slideIndex * 100;
      carouselInner.style.transform = `translateX(${offset}%)`;
      updateDots();
    }

    // 更新所有圓點，顯示當前幻燈片對應的圓點
    function updateDots() {
      const dots = carouselDots.getElementsByTagName('span');
      for (let i = 0; i < dots.length; i++) {
        dots[i].classList.remove('active');
      }
      dots[slideIndex].classList.add('active');  // 更新圓點狀態
    }
  </script>

</body>

</html>