<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>member_register</title>
<link rel="stylesheet" th:href="@{/css/member.css}">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
	integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
	crossorigin="anonymous" referrerpolicy="no-referrer" />
<script th:src="@{/js/member.js}"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<!-- Google註冊 -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<script>

function checkAccount(){
	let account=document.getElementById("member_register_Account").value;
	fetch('/member/isexist/'+account)
	.then(response=>{
		if(!response.ok){
			throw new Error('帳號存在');
		}
		return response.json();
	})
	.then(data=>{
		document.getElementById("checkMesg").innerHTML=data.mesg;
		if(data.mesg==="帳號可以註冊"){
			document.getElementById("checkMesg").style.color="green";	
		}else{
			document.getElementById("checkMesg").style.color="red";
		}
		
	})
	.catch(error=>{
		console.error('err:',error);
	});
}

function register(){
	event.preventDefault();
	let account=document.getElementById("member_register_Account").value;
	let password=document.getElementById("member_register_Password").value;
	let email=document.getElementById("member_register_Email").value;
	
	let data={
			account:account,
			password:password,
			email:email
	};
	
	fetch('/member/register',{
		method:"POST",
		headers:{
			"Content-Type":"application/json"
		},
		body:JSON.stringify(data)
	})
	.then(response=>{
		if(!response.ok){
			return response.json().then(data=>{
				throw new Error(data.message||"註冊失敗");
			});
		}
		return response.json();
	})
	.then(data=>{
		alert("註冊成功！");
		 	document.getElementById("member_register_Account").value = "";
	        document.getElementById("member_register_Password").value = "";
	        document.getElementById("member_register_Email").value = "";
	        document.getElementById("checkMesg").innerText = "";
	})
	.catch(error=>{
		alert(error.message || "註冊失敗!");
		console.error('err:',error);
	});
}


</script>

<!-- <div th:include="header"></div> -->
<main id="member_register_BigContainer">
	<section id="member_register_Container">
		<div>
			<h2>會員註冊</h2>
			<form>
				<div class="member_register_Group">
					<label for="member_register_Account">帳號</label> <input type="text"
						id="member_register_Account" name="account"
						onblur="checkAccount()" /><span id="checkMesg"></span>
				</div>

				<div class="member_register_Group">
					<label for="member_register_Password">密碼</label> <input
						type="password" id="member_register_Password" name="password" />
				</div>

				<div class="member_register_Group">
					<label for="member_register_Email">電子郵件</label> <input type="email"
						id="member_register_Email" name="email" />
				</div>

				<button type="submit" id="member_register_Button"
					onclick="register()">註冊</button>
			</form>
			<div id="member_register_Or">或</div>

			<!--Google註冊-->
			<div id="g_id_onload" data-client_id="YOUR_GOOGLE_CLIENT_ID"
				data-callback="handleGoogleSignIn" data-auto_prompt="false"></div>
			<div class="g_id_signin" data-type="standard" data-size="large"
				data-theme="outline" data-text="sign_in_with"
				data-shape="rectangular" data-logo_alignment="left"></div>
		</div>
	</section>
</main>

<!--<div th:include="footer"></div>  -->